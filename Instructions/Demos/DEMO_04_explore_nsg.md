<!---
---
데모: 제목: ‘Azure NSG(네트워크 보안 그룹)’ 학습 경로/모듈/단원: ‘학습 경로: Microsoft 보안 솔루션의 기능을 설명, 모듈 1: Azure의 기본 보안 기능을 설명, 단원 6: Azure 네트워크 보안 그룹 설명’
---
--->

# 데모: Azure NSG(네트워크 보안 그룹)

이 데모는 다음 Learn 콘텐츠에 매핑됩니다.

- 학습 경로: Microsoft 보안 솔루션의 기능 설명
- 모듈: Azure의 기본적인 보안 기능 설명
- 단원: Azure 네트워크 보안 그룹 설명

## 데모 시나리오

이 데모에서는 Azure에서 네트워크 보안 그룹의 기능을 살펴보고 미리 만든 가상 머신에 NSG를 적용합니다. 먼저 ALH(권한 있는 랩 호스터)에서 미리 만든 VM에 대한 정보를 간략하게 보여 줍니다. 그런 다음, 데모 전 설정의 일부로 설정되었던 NSG를 사용하여 NSG의 필수 매개 변수와 기본 인바운드 및 아웃바운드 규칙을 표시합니다. VM 인터페이스를 NSG에 할당하고, VM에 대한 연결을 허용하는 새 RDP 규칙을 만들고, 마지막으로 테스트합니다.

### 데모 1부

이 부분에서는 설치 데모(DEMO_00_pre_demo_setup.md)의 일부로 만든 VM과 연결된 매개 변수 중 일부를 볼 수 있습니다.

1. Microsoft Edge를 엽니다.  주소 표시줄에서 ALH(권한 있는 랩 호스트)에서 제공한 Azure 자격 증명을 입력 **https://portal.azure.com** 하고 로그인합니다.  그러면 Azure 서비스 홈페이지로 이동합니다.

1. 페이지 맨 위에 있는 파란색 검색 상자에 **Virtual Machines** 입력한 다음 검색 결과에서 **Virtual Machines** 선택합니다.

1. 가상 머신 페이지에서 나열된 VM **SC900-WinVM**을 선택합니다.  이 VM은 데모 전 설정의 일부로 만들어졌어야 합니다.  해당 항목이 나열되지 않은 경우 지금 만듭니다.

1. 이제 SC900-WinVM 페이지가 표시됩니다.  VM에 대한 몇 가지 기본 정보를 확인합니다.

1. 왼쪽 탐색 패널에서 **네트워킹**을 선택합니다.  
    1. 기본 보기는 인바운드 포트 규칙에 대한 것입니다.  이 VM의 네트워크 인터페이스에는 네트워크 보안 그룹이 구성되어 있지 않습니다.  아웃바운드 포트 규칙을 선택하는 경우에도 마찬가지입니다.
    1. 네트워크 인터페이스가 표시된 위치 옆에 있는 **효과적인 보안 규칙**을 선택합니다.  “네트워크 보안 그룹 또는 애플리케이션 보안 그룹이 네트워크 인터페이스와 연결되어 있지 않습니다”라고 표시됩니다.

1. 발표자에게 참고합니다. 연결 페이지에서 포트 상태 검사 시도하려는 경우 "확인할 수 없음" 메시지가 표시됩니다.  포트가 노출되지 않는다는 의미는 아닙니다.  NSG가 할당된 동일한 작업을 수행할 때 참고할 수 있듯이 해당 포트의 트래픽이 차단되었음을 나타내는 "액세스할 수 없음"이 표시됩니다.


1. 이 브라우저 탭을 열어 둡니다.

### 데모 2부

이 부분에서는 NSG에 인터페이스를 할당합니다. 규칙의 작동 방식을 보여 주는 기본 인바운드 및 아웃바운드 규칙에 대해 설명합니다.  데모 전 설정의 일부로 VM은 해당 NSG에 VM의 네트워크 인터페이스를 할당하고 RDP 트래픽에 대한 새 인바운드 규칙을 만들어야 합니다.

1. Azure Portal(portal.azure.com)에 새 브라우저 탭을 열고 페이지 위쪽의 파란색 검색 창에서 **네트워크 보안 그룹 그룹을** 입력합니다. 결과에서 **네트워크 보안 그룹**(네트워크 보안 그룹 클래식 선택 안 함)을 선택합니다.

1. 데모 전 설정의 일부로 만든 NSG를 선택합니다. 이전에 만들지 않은 경우 지금 만듭니다. **네트워크 보안 그룹 만들기**를 선택하고 다음 설정을 지정합니다.
    1. 구독: 기본값을 그대로 둡니다(권한 있는 랩 호스터에서 제공하는 Azure 구독).
    1. 리소스 그룹:  **LabsSC900** (VM에서 사용하는 것과 동일한 리소스 그룹).
    1. 이름:  **NSG-SC900**
    1. 지역: 기본값을 유지합니다.
    1. **검토 + 만들기**, **만들기**를 차례로 선택합니다.
    1. 배포가 완료되면(매우 빠르게 발생) **리소스로 이동을** 선택합니다.

1. Essentials라고 표시된 페이지 맨 위에 만든 NSG에 대한 몇 가지 기본 정보가 표시됩니다.  두 가지 유의할 점은 사용자 지정 보안 규칙이 없으며 이 NSG와 연결된 서브넷이나 네트워크 인터페이스가 없다는 것입니다.  사용자 지정 보안 규칙은 없지만 페이지에 표시된 대로 모든 NSG에 포함된 기본 인바운드 및 아웃바운드 규칙이 있습니다.  인바운드 및 아웃바운드 규칙을 모두 검토합니다. 기본 인바운드 규칙은 가상 네트워크 또는 Azure 부하 분산 장치에서 전송되지 않은 모든 인바운드 트래픽을 거부합니다.  아웃바운드 규칙은 가상 네트워크 간 트래픽과 인터넷으로의 아웃바운드 트래픽을 제외한 모든 아웃바운드 트래픽을 거부합니다.

1. NSG-SC900 페이지 왼쪽 탐색 창의 설정 아래에서 **네트워크 인터페이스**를 선택합니다.
    1. **연결**을 선택합니다.
    1. 네트워크 인터페이스 연결을 선택하는 필드에서 **드롭다운 화살표**를 선택하고 **sc900-winvmXXX**를 선택한 다음, 창 아래쪽에서 **확인**을 선택합니다. NSG에 연결된 인터페이스는 목록에 표시됩니다.

1. VM에 대한 브라우저 탭을 선택하여 VM을 반환합니다.  이제 VM 인터페이스에 연결된 NSG가 있음을 알 수 있습니다.  인바운드 포트 규칙 테이블이 표시됩니다. 기본 인바운드 규칙은 가상 네트워크 또는 Azure 부하 분산 장치에서 전송되지 않은 모든 인바운드 트래픽을 거부합니다.  이를 테스트하려면 RDP 포트 3389에서 상태 검사.
    1. 페이지 위쪽에서 **연결을** 선택한 다음 포트 3389(RDP)에 대한 **액세스 확인을** 선택하면 "액세스할 수 없음"이 표시됩니다.  
    1. RDP 포트 3389에 대해서만 테스트하지만 다른 가상 네트워크 또는 부하 분산 장치에서 온 것이 아닌 모든 인바운드 네트워크 트래픽이 차단됩니다.  

1. 이제 RDP 포트에서 인바운드 트래픽을 허용하는 규칙을 만듭니다.  왼쪽 탐색 창에서 **네트워킹을** 선택합니다. 인바운드 포트 규칙 테이블이 표시되어야 합니다(인바운드 포트 규칙 탭에 밑줄이 표시됨).  페이지의 오른쪽에서 **인바운드 포트 규칙 추가를** 선택합니다. 중요한 점은 기본 규칙을 제거할 수는 없지만 우선 순위가 높은 규칙을 만들어 재정의할 수 있다는 것입니다. 인바운드 보안 규칙 추가 창에서 다음 설정을 지정합니다.
    1. 원본:  **모두**
    1. 원본 포트 범위: **\***
    1. 대상:  **모두**
    1. 서비스:  **RDP**
    1. 작업:  **허용**
    1. 우선 순위:  **1000**. 참고: 번호가 낮은 규칙은 우선 순위가 더 높으며 먼저 처리됩니다.
    1. 이름: 기본 이름을 그대로 두거나 고유한 설명이 포함된 이름을 만듭니다.
    1. 페이지 아래쪽에 경고 기호를 확인합니다.  NSG의 기능을 보여 주기 위해 테스트 목적으로만 RDP를 사용하고 있습니다.
    1. **추가**를 선택합니다.

1. 규칙이 프로비전되면 인바운드 규칙 목록에 표시됩니다(화면을 새로 고침해야 할 수 있습니다).

### 데모 3부

VM에 연결된 NSG와 생성된 RDP 규칙을 사용하면 VM에 대한 RDP 연결을 테스트하여 NSG의 영향을 보여 줍니다.

1. 브라우저에서 SC900-WinVM – Microsoft Azure 탭을 엽니다. 

1. 왼쪽 탐색 패널에서 **연결**을 선택합니다.
    1. **검사 액세스를** 선택할 수 있습니다.  상태 "액세스 가능"으로 표시되어야 합니다. 또는 시간이 있는 경우 Windows에서 원격 데스크톱 연결의 instance 열어 VM에 연결할 수 있습니다.  이 옵션은 VM에 성공적으로 연결되면 VM을 엽니다.  아래에 나열된 단계는 다음과 같습니다.
        1. Windows 검색 창에서 **원격 데스크톱 연결을** 입력한 다음 **열기**를 선택합니다.
        1. 컴퓨터라는 옆에 있는 필드에 VM의 **** 공용 IP 주소를 입력합니다.
        1. IP 주소를 입력하면 IP 주소를 입력한 필드 아래에 사용자 이름이 표시됩니다. 그렇지 않은 경우 **옵션 표시**를 확장하고 VM의 사용자 이름을 입력한 다음 **연결을 선택합니다.**
        1. 원격 데스크톱 연결 창이 열리고 '원격 컴퓨터의 ID를 확인할 수 없습니다. 연결하시겠습니까?'라는 메시지가 나타납니다. **예**를 선택합니다.
        1. 이제 VM에 연결되었습니다. 이번에 VM에 연결할 수 있었던 이유는, 방금 만든 인바운드 트래픽 규칙이 RDP를 통해 VM으로 전송되는 인바운드 트래픽을 허용하기 때문입니다.
        1. VM의 IP 주소를 표시하는 파란색 탭에서 밑줄 **_** 을 선택하여 VM을 최소화합니다. SC900-WinVM | 연결 페이지로 돌아갑니다.

1. 왼쪽 탐색 패널에서 **네트워킹을** 선택한 다음, 기본 창에서 **아웃바운드 포트 규칙을** 선택합니다.  기본 아웃바운드 규칙에 대해 말합니다. 기본 규칙은 모든 가상 네트워크에서 다른 가상 네트워크로의 아웃바운드 VNet 트래픽을 허용하고 아웃바운드 인터넷 트래픽을 허용합니다. 다른 유형의 아웃바운드 트래픽은 거부됩니다.  기본 규칙을 제거할 수는 없지만 인바운드 규칙을 만든 것과 동일한 방식으로 우선 순위가 높은 규칙을 만들어 재정의할 수 있습니다.

1. 타이머가 허용되고 아웃바운드 트래픽에 대해 유사한 단계를 표시하려는 경우 아래에 나열된 선택적 데모 부분을 거칩니다.  그렇지 않으면 VM에서 종료되지만 다음 데모를 위해 브라우저에서 Azure 탭을 열어 둡 수 있습니다.

### 선택적 데모 4부

이 부분에서는 VM에서 아웃바운드 인터넷 트래픽을 허용하는 현재 NSG 아웃바운드 규칙을 보여 줍니다.  그런 다음 VM에서 아웃바운드 인터넷 트래픽을 차단하는 규칙을 만듭니다. 마지막으로 VM에서 인터넷에 액세스하려고 시도하여 새로 만든 규칙의 영향을 표시합니다.

1. 이전 단계에서 최소화한 VM을 엽니다. 여기서는 기본 아웃바운드 규칙 중 하나에서 사용하도록 설정된 인터넷에 대한 아웃바운드 인터넷 연결을 보여 줍니다. VM이 열리고 사용자로 로그인한 후 **Microsoft Edge** 를 선택하여 브라우저를 엽니다.  Microsoft Edge를 처음 열 때 팝업 창이 나타나면 **데이터 없이 시작**을 선택하고 **이 데이터 없이 계속**을 선택한 다음 **확인 및 검색 시작**을 선택할 수 있습니다.
    1. 브라우저 주소 표시줄에 **www.bing.com**을 입력하고 검색 엔진에 연결할 수 있는지 확인합니다.
    1. www.bing.com에 액세스할 수 있음을 확인했으면 VM에서 브라우저 창을 닫고 VM을 종료합니다.

1. VM의 IP 주소를 표시하는 파란색 탭에서 밑줄 **_** 을 선택하여 VM을 최소화합니다. SC900-WinVM | 연결 페이지로 돌아갑니다.  

1. 왼쪽 탐색 패널에서 **네트워킹**을 선택합니다.

1. **아웃바운드 포트 규칙** 탭을 선택합니다. 기본 아웃바운드 규칙을 확인할 수 있습니다.  기본 규칙은 "AllowInternetOutBound"입니다. 이 규칙은 모든 아웃바운드 인터넷 트래픽을 허용합니다. 기본 규칙을 제거할 수는 없지만, 우선 순위가 더 높은 규칙을 만들어 규칙을 재정의할 수 있습니다. 페이지 오른쪽에서 **아웃바운드 포트 규칙 추가**를 선택합니다.

1. 아웃바운드 보안 규칙 추가 페이지에서 다음 설정을 지정합니다.
    1. 원본:  **모두**
    1. 원본 포트 범위:  **\***
    1. 대상:  **서비스 태그**
    1. 대상 서비스 태그:  **인터넷**
    1. 서비스:  **사용자 지정**(기본값 유지)
    1. 대상 포트 범위: *(대상 포트 범위 필드에 별표를 추가해야 함)
    1. 프로토콜: **모두**
    1. 작업: **Deny**
    1. 우선 순위:  **1000**
    1. 이름: 기본 이름을 그대로 두거나 고유한 설명이 포함된 이름을 만듭니다.
    1. **추가**를 선택합니다.

1. 프로비전된 규칙은 아웃바운드 규칙 목록에 표시됩니다.  규칙이 목록에 표시되기는 하지만 적용되려면 몇 분 정도 걸립니다(다음 단계를 계속 진행하기 전에 몇 분 기다려야 함).  

1. VM으로 돌아갑니다(VM 아이콘은 페이지 아래쪽의 작업 표시줄에 표시되어야 합니다).

1. VM에서 Microsoft Edge 브라우저를 열고 **www.bing.com**을 입력합니다. 페이지가 표시되지 않아야 합니다.  참고: 인터넷에 연결할 수 있고 아웃바운드 규칙의 모든 매개 변수가 올바르게 설정되었음을 확인한 경우 규칙이 적용되는 데 몇 분 정도 걸릴 수 있기 때문입니다.  이 경우에는 브라우저를 닫고 몇 분 정도 기다렸다가 다시 시도하세요.  참고: 랩 환경의 Azure 구독은 평소보다 더 오래 지연될 수 있습니다.

1. IP 주소가 표시된 페이지 위쪽 가운데에서 **X**를 선택하여 원격 데스크톱 연결을 닫습니다.  원격 세션의 연결이 끊어짐을 나타내는 팝업 창이 표시됩니다. **확인**을 선택합니다.

1. 다음 Azure 데모를 위해 브라우저에서 Azure 탭을 열어 두세요.

### 검토

이 데모에서는 NSG와 연관된 정보 및 설정을 살펴보았습니다. 그리고 NSG에 인터페이스를 연결하는 프로세스와 기본 인바운드 및 아웃바운드 규칙을 확인했으며 마지막으로 새 규칙을 만드는 단계를 진행했습니다.
